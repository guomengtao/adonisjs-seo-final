<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Search Missing Persons</title>
    <link href="./dist/localtailwind.css" rel="stylesheet">
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; -webkit-font-smoothing: antialiased; }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        strong { font-weight: bold; color: red; }
        /* 隐藏电脑端滚动条，保持简洁 */
        @media (min-width: 1024px) { 
            ::-webkit-scrollbar { width: 6px; } 
            ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; } 
        }
        .content-container { max-width: 800px; margin: 0 auto; }
        .search-input { border-radius: 20px; padding: 8px 16px; border: 1px solid #ddd; font-size: 16px; width: 100%; }
        .search-results { margin-top: 20px; max-height: 60vh; overflow-y: auto; }
        .result-item { padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; }
        .result-item:hover { background-color: #f5f5f5; }
        .result-name { font-weight: bold; font-size: 16px; }
        .result-id { font-size: 14px; color: #666; margin-top: 4px; }
        .loading { text-align: center; padding: 20px; color: #666; }
        .no-results { text-align: center; padding: 20px; color: #666; }
        /* 微信样式优化 */
        body { padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); }
        .search-container { position: sticky; top: 0; background-color: white; padding: 10px 0; z-index: 100; }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-900">
    <!-- 头部 -->
    <header class="bg-white shadow-md">
        <div class="content-container px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <h1 class="text-2xl font-bold text-blue-600">Missing Persons Database</h1>
            </div>
            <nav>
                <ul class="flex space-x-4">
                    <li><a href="./index.html" class="text-gray-600 hover:text-blue-600">Home</a></li>
                    <li><a href="./search.html" class="text-blue-600 font-bold">Search</a></li>
                </ul>
            </nav>
        </div>
    </header>
    
    <!-- 主要内容 -->
    <main class="py-8">
        <div class="content-container px-4">
            <h1 class="text-3xl font-bold mb-8">Search Missing Persons</h1>
            
            <!-- 搜索区域 -->
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search by name or case ID..." class="search-input">
            </div>
            
            <!-- 搜索结果 -->
            <div id="searchResults" class="search-results">
                <div class="loading">Loading search data...</div>
            </div>
        </div>
    </main>
    
    <!-- 页脚 -->
    <footer class="bg-gray-800 text-white py-8 safe-bottom">
        <div class="content-container px-4">
            <p class="text-center text-sm">Missing Persons Database © 2023</p>
        </div>
    </footer>
    
    <script>
        // 搜索数据数组
        let searchData = [];
        
        // 加载搜索数据
        async function loadSearchData() {
            try {
                const response = await fetch('./dist/search_local.txt');
                const text = await response.text();
                
                // 解析搜索数据
                searchData = text.split('\n')
                    .filter(line => line.trim())
                    .map(line => {
                        const [name, caseId, path] = line.split('|');
                        return { name, caseId, path };
                    });
                
                document.getElementById('searchResults').innerHTML = '<div class="no-results">Start typing to search...</div>';
            } catch (error) {
                console.error('Error loading search data:', error);
                document.getElementById('searchResults').innerHTML = '<div class="no-results">Error loading search data. Please try again later.</div>';
            }
        }
        
        // 执行搜索
        function performSearch(query) {
            if (!query.trim()) {
                document.getElementById('searchResults').innerHTML = '<div class="no-results">Start typing to search...</div>';
                return;
            }
            
            const lowercaseQuery = query.toLowerCase();
            const results = searchData.filter(item => 
                item.name.toLowerCase().includes(lowercaseQuery) || 
                item.caseId.toLowerCase().includes(lowercaseQuery)
            );
            
            displayResults(results);
        }
        
        // 显示搜索结果
        function displayResults(results) {
            const resultsContainer = document.getElementById('searchResults');
            
            if (results.length === 0) {
                resultsContainer.innerHTML = '<div class="no-results">No matching results found.</div>';
                return;
            }
            
            const resultsHTML = results.map(item => `
                <div class="result-item" onclick="window.location.href='./${item.path}/index.html'">
                    <div class="result-name">${escapeHtml(item.name)}</div>
                    <div class="result-id">Case ID: ${escapeHtml(item.caseId)}</div>
                </div>
            `).join('');
            
            resultsContainer.innerHTML = resultsHTML;
        }
        
        // HTML转义函数
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            loadSearchData();
            
            // 搜索输入事件
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', () => {
                performSearch(searchInput.value);
            });
            
            // 自动聚焦搜索框
            searchInput.focus();
        });
    </script>
</body>
</html>